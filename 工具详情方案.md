# Anime Last Stand - 阵容DPS优化器：详细技术方案

## 一、游戏机制概述

### 1.1 游戏类型与核心玩法

**Anime Last Stand** 是一款塔防策略游戏，核心玩法包括：

- **单位召唤系统**：通过抽卡(Portal/Banner)获取动漫角色单位
- **阵容配置**：从已拥有单位中选择有限数量组成战斗阵容
- **塔防战斗**：在地图上放置并升级单位，抵御敌人波次
- **升级成长**：通过战斗获得资源，提升单位等级和能力
- **挑战进阶**：不断挑战更高难度关卡(Story Mode Acts)

### 1.2 稀有度系统

单位按稀有度从高到低分为：
1. **Godly** (神级) - 最稀有，通过特殊途径获得
2. **Ultimate** (终极) - Banner 2 (0.01%), Banner 3 (0.3%)
3. **Exotic** (异域) - 限定/专属单位
4. **Celestial** (天界) - Banner掉落+关卡掉落
5. **Mythic** (神话) - 所有Banner可获得
6. **Legendary** (传奇) - 22%概率(Banner 3)
7. **Epic** (史诗) - 30%概率(Banner 3)
8. **Rare** (稀有) - 40.2%概率(Banner 3)

### 1.3 单位进化系统

部分单位可以进化(Evolve)：
- Ultimate → Evolved Ultimate
- Exotic → Evolved Exotic
- Celestial → Evolved Celestial
- Mythic → Evolved Mythic

### 1.4 技能系统 (Techniques)

技能是可以给单位提供显著增益的修饰符：
- 使用 **Technique Shards** 进行抽取
- 不同稀有度技能提供不同增益效果
- 可以选择跳过不需要的技能类型

**技能属性加成类型：**
- 伤害增加 (Damage +%)
- 攻击范围增加 (Range +%)
- 攻击速度提升 (SPA -%)
- 金钱收益增加 (Money +%)
- 暴击几率/伤害增加 (Crit Chance/Damage +%)
- DoT伤害相关增益

**技能稀有度梯度示例：**
- 普通技能：伤害+5%/+8%/+10%
- 高级技能：伤害+15%/+25%，附加其他属性
- 彩虹技能：伤害+425%~750%，大幅提升多个属性，但限制单次放置

---

## 二、核心工具定位

### 2.1 用户痛点

**问题：计算复杂度爆炸**
- 上百个单位 × 多个等级 × 技能组合 = 天文数字的阵容可能性
- 玩家无法手动计算最优阵容
- 缺乏个性化的阵容建议（基于玩家实际拥有的单位）

**差异化优势：**
- ❌ **Fandom Wiki**：只能展示静态数据，无法计算组合效果
- ❌ **YouTube攻略**：展示的是"全游戏最强阵容"(需要所有Godly单位)，不适用于普通玩家
- ✅ **我们的工具**：基于玩家实际单位池，计算个性化最优阵容

### 2.2 核心价值主张

> **"告诉玩家，用他们现有的单位，能组出的最强阵容是什么，以及为什么。"**

---

## 三、所需游戏数据

### 3.1 单位数据 (Units Data)

从 `https://alsroblox.fandom.com/wiki/Units` 和各单位详情页采集：

#### 基础信息
- `name`: 单位名称
- `rarity`: 稀有度 (Godly/Ultimate/Exotic/Celestial/Mythic/Legendary/Epic/Rare)
- `element`: 元素属性 (Dark/Light/Fire/Water/Nature等)
- `role`: 角色定位 (DPS/Support/Tank/AoE等)
- `maxLevel`: 最高等级
- `canEvolve`: 是否可进化
- `evolvedForm`: 进化后形态名称

#### 战斗属性（按等级）
对于每个等级(1-MaxLevel)，需要采集：
- `damage`: 基础伤害值
- `dps`: 每秒伤害 (Damage Per Second)
- `range`: 攻击范围
- `attackSpeed`: 攻击速度/攻击间隔 (SPA - Seconds Per Attack)
- `placementCost`: 放置成本（初始）
- `upgradeCosts`: 升级成本数组 [Level1→2, Level2→3, ...]
- `targetType`: 目标类型 (单体/AoE/地面/空中)
- `specialAbilities`: 特殊能力描述

#### 技能兼容性
- `compatibleTechniques`: 可以装备的技能类型
- `critChance`: 基础暴击率
- `critDamage`: 基础暴击伤害倍率

**数据结构示例：**
```json
{
  "unitId": "unit_001",
  "name": "Godly Unit Example",
  "rarity": "Godly",
  "element": "Dark",
  "role": "DPS",
  "maxLevel": 100,
  "canEvolve": false,
  "stats": [
    {
      "level": 1,
      "damage": 100,
      "dps": 50,
      "range": 20,
      "attackSpeed": 2.0,
      "placementCost": 500,
      "upgradeCost": 200
    },
    {
      "level": 2,
      "damage": 120,
      "dps": 60,
      "range": 20,
      "attackSpeed": 2.0,
      "placementCost": 500,
      "upgradeCost": 300
    }
    // ... 更多等级
  ]
}
```

### 3.2 技能数据 (Techniques Data)

从 `https://alsroblox.fandom.com/wiki/Techniques` 采集：

```json
{
  "techniqueId": "tech_001",
  "name": "某某技能",
  "tier": 1,
  "rarity": "Common",
  "probability": 12.0,
  "effects": {
    "damageMultiplier": 1.05,
    "rangeMultiplier": 1.0,
    "attackSpeedMultiplier": 1.0,
    "moneyMultiplier": 1.0,
    "critChanceBonus": 0,
    "critDamageMultiplier": 1.0
  },
  "restrictions": {
    "maxPlacements": null
  }
}
```

**关键技能数据点：**
- 技能名称和稀有度
- 掉落概率
- 各属性加成系数
- 特殊限制（如"ONE PLACEMENT"）

### 3.3 关卡/地图数据 (Maps/Stages Data)

从Story Mode和各关卡页面采集：

```json
{
  "mapId": "desert_village_act6",
  "name": "Desert Village - Act 6",
  "difficulty": "Insane",
  "waves": [
    {
      "waveNumber": 1,
      "enemies": [
        {
          "enemyType": "Ground_Fast",
          "hp": 5000,
          "count": 20,
          "speed": 5.0,
          "resistances": {},
          "reward": 50
        }
      ]
    },
    {
      "waveNumber": 5,
      "enemies": [
        {
          "enemyType": "Air_Swarm",
          "hp": 2000,
          "count": 50,
          "speed": 7.0,
          "reward": 100
        }
      ]
    }
    // ... Wave 10 Boss等
  ],
  "totalWaves": 10,
  "baseIncome": 500,
  "incomePerWave": 100
}
```

**关键数据点：**
- 每波敌人类型、血量、数量、速度
- 击杀奖励金钱
- 局内经济曲线

### 3.4 道具数据 (Items Data)

从 `https://alsroblox.fandom.com/wiki/Items` 采集：

可能影响战斗的道具效果（如果有）：
- 增益道具
- 货币加成道具
- 经验加成道具

### 3.5 Tier List数据

从 `https://alsroblox.fandom.com/wiki/Tier_List` 采集：

作为参考和验证：
- Progressive模式评级
- 各元素属性评级
- 社区推荐的强力单位

**用途：**
- 验证我们计算结果的合理性
- 作为初始推荐的参考权重
- 向用户展示社区共识对比

---

## 四、核心计算公式

### 4.1 单位有效DPS计算

```
有效DPS = 基础DPS × 技能伤害倍率 × (1 + 暴击率 × (暴击伤害 - 1))
```

**详细公式：**
```
effectiveDPS = baseDPS 
              × (1 + techniquesDamageBonus)
              × (1 + critChance × (critDamage - 1))
              × targetCoverageRate
```

**参数说明：**
- `baseDPS`: 单位在特定等级的基础DPS值
- `techniquesDamageBonus`: 技能提供的伤害加成（如+25% = 0.25）
- `critChance`: 暴击率（基础值 + 技能加成）
- `critDamage`: 暴击伤害倍率（基础值 × 技能倍率）
- `targetCoverageRate`: 目标覆盖率（AoE vs 单体，空中 vs 地面）

### 4.2 阵容总输出计算

```
阵容总DPS = Σ(每个单位的有效DPS × 攻击覆盖率)
```

**攻击覆盖率因素：**
- 单位攻击范围能覆盖多少地图面积
- 单体/AoE的目标效率
- 地面/空中单位对特定波次的有效性

### 4.3 成本效益分析

#### 单位性价比
```
单位性价比 = 有效DPS / (放置成本 + 升级成本总和)
```

#### 阵容成本曲线
```
第N波可用金钱 = 初始金钱 + Σ(前N-1波的击杀奖励) + 波次奖励
第N波阵容成本 = Σ(已放置单位成本 + 已升级成本)
经济压力 = 阵容成本 / 可用金钱
```

**关键节点：**
- 关键波次(如第5波空中单位)前能否成型所需单位
- 升级还是新放置的决策点

### 4.4 波次通关能力评估

```
波次通关能力 = (阵容总DPS × 波次持续时间) / 敌人总血量

敌人总血量 = Σ(每种敌人HP × 数量)
波次持续时间 = 地图路径长度 / 敌人平均速度
```

**通关条件：**
```
IF 波次通关能力 ≥ 1.2 THEN "安全通关"
ELSE IF 波次通关能力 ≥ 1.0 THEN "勉强通关"
ELSE "失败"
```

### 4.5 阵容优化目标函数

```
综合评分 = α × 平均通关能力 
         + β × 最低波次通关能力
         + γ × 成本效率
         - δ × 阵容风险度

阵容风险度 = Σ(低于1.2通关能力的波次数) / 总波次数
```

**权重建议：**
- α = 0.3（整体输出）
- β = 0.5（最弱环节，避免单点失败）
- γ = 0.1（成本优化）
- δ = 0.4（风险惩罚）

### 4.6 升级收益计算

```
升级性价比 = (升级后DPS - 当前DPS) / 升级成本

阵容提升率 = (新阵容总DPS - 旧阵容总DPS) / 旧阵容总DPS
```

---

## 五、工具核心功能模块

### 5.1 用户输入模块

**输入界面：**
1. **单位池管理**
   - 勾选/取消勾选拥有的单位
   - 为每个单位设置当前等级
   - 显示单位基础信息（稀有度、属性、角色）

2. **技能配置（可选）**
   - 为关键单位选择已拥有的技能
   - 技能效果预览

3. **目标关卡选择**
   - 选择卡关的具体地图和Act
   - 显示关卡难度和推荐等级

**存储：**
- 本地存储(LocalStorage/IndexedDB)保存用户数据
- 支持导入/导出功能（JSON格式）

### 5.2 阵容计算引擎

**核心算法：**

#### 暴力枚举优化（小规模单位池）
- 对于单位池 ≤ 20个：枚举所有6-8单位组合
- 对每个组合计算综合评分
- 返回Top 5阵容

#### 遗传算法（大规模单位池）
- 初始种群：随机生成N个阵容（N=100）
- 适应度函数：上述综合评分公式
- 选择：保留Top 30%
- 交叉：随机交换单位
- 变异：随机替换/升级单位
- 迭代500代，收敛到最优解

#### 贪婪算法（快速推荐）
- 按单位性价比排序
- 优先选择高DPS、低成本单位
- 确保覆盖所有目标类型（地面/空中/AoE）

### 5.3 结果展示模块

#### 最优阵容推荐
```
[推荐阵容]
1. 单位A (Lv.50, Godly) - 主力DPS
2. 单位B (Lv.70, Ultimate) - AoE清场
3. 单位C (Lv.60, Celestial) - 空中覆盖
4. 单位D (Lv.45, Mythic) - 经济单位
5. 单位E (Lv.55, Exotic) - Boss伤害
6. 单位F (Lv.40, Legendary) - 范围支援

总DPS: 125,000
总成本: 45,000金币
通关概率: 92%
```

#### 阵容诊断
```
[通关分析]
✅ Wave 1-4: 安全通关 (150%输出冗余)
⚠️ Wave 5 (空中): 勉强通关 (105%输出)
  → 建议：升级单位C到Lv.65 (+8% DPS)
✅ Wave 6-9: 安全通关
⚠️ Wave 10 (Boss): 112%输出
  → 建议：为单位E装备暴击技能
```

#### 升级建议
```
[性价比升级路径]
1. 单位C: Lv.60 → Lv.65
   成本: 5,000金币
   DPS提升: +8%
   性价比: 1.6 DPS/千金币 ⭐推荐

2. 单位A: Lv.50 → Lv.55
   成本: 8,000金币
   DPS提升: +10%
   性价比: 1.25 DPS/千金币

3. 单位B: Lv.70 → Lv.75
   成本: 12,000金币
   DPS提升: +12%
   性价比: 1.0 DPS/千金币
```

#### 对比分析
```
[你的阵容 vs 社区Tier List]
你的阵容使用了2个S-Tier单位，3个A-Tier，1个B-Tier
社区推荐的最强阵容需要6个S-Tier单位（你只拥有2个）

针对Desert Village Act 6：
你的阵容DPS: 125,000 (超过通关需求15%)
社区最强阵容DPS: 200,000 (超过通关需求80%)
结论: 你的阵容足够通关，无需追求完美阵容
```

### 5.4 数据可视化

**图表类型：**

1. **阵容DPS分布图**
   - 雷达图：展示对各波次的输出能力
   - 柱状图：各单位贡献占比

2. **成本曲线图**
   - 折线图：金钱收入 vs 阵容成本随波次变化
   - 标注关键节点（成本压力最大的波次）

3. **升级路径树**
   - 树状图：展示不同升级顺序的DPS增长

---

## 六、技术架构

### 6.1 前端技术栈

- **框架**: Next.js 16 (React)
- **UI组件**: shadcn/ui + Tailwind CSS
- **图表**: Recharts / Chart.js
- **状态管理**: Zustand
- **数据存储**: IndexedDB (Dexie.js)

### 6.2 后端技术栈（可选）

**方案A：纯前端（推荐）**
- 所有计算在浏览器端完成
- 游戏数据打包为静态JSON
- 部署到Vercel/Netlify

**方案B：前后端分离**
- 后端: Node.js + Express
- 数据库: PostgreSQL (存储游戏数据)
- API: RESTful API提供数据查询和计算服务
- 缓存: Redis (缓存常见计算结果)

### 6.3 数据采集

**爬虫策略：**
```javascript
// 伪代码
async function scrapeUnitData(unitUrl) {
  const page = await puppeteer.launch(unitUrl);
  
  // 提取单位基础信息
  const basicInfo = extractBasicInfo(page);
  
  // 提取等级数据表格
  const statsTable = extractStatsTable(page);
  
  // 解析为JSON
  return {
    ...basicInfo,
    stats: statsTable
  };
}
```

**数据清洗：**
- 处理缺失值（某些等级可能无数据）
- 数值标准化（移除千分位逗号，统一单位）
- 关联检查（确保单位-技能-关卡数据一致性）

---

## 七、开发路线图

### Phase 1: MVP (2周)
- [ ] 数据采集：爬取所有单位的基础数据
- [ ] 核心计算：实现简化版DPS计算（不考虑技能）
- [ ] 简单UI：单位选择 + 阵容推荐
- [ ] 验证：对比Tier List，确保推荐合理性

### Phase 2: 完整功能 (2周)
- [ ] 技能系统：整合技能数据和计算
- [ ] 关卡数据：接入关卡敌人数据，实现波次分析
- [ ] 升级建议：计算最优升级路径
- [ ] 数据可视化：添加图表展示

### Phase 3: 优化与扩展 (1周)
- [ ] 性能优化：大规模计算的算法优化
- [ ] 用户体验：响应式设计、动画效果
- [ ] 社交功能：阵容分享、评论
- [ ] 持续更新：游戏版本更新时自动同步数据

---

## 八、预期价值与成功指标

### 8.1 核心价值

**对玩家：**
- 节省50%+的试错时间
- 提供个性化建议（不是千篇一律的"最强阵容"）
- 清晰解释"为什么"这个阵容好

**对项目方：**
- 差异化竞争优势（Fandom/YouTube无法提供的价值）
- 高用户粘性（每次卡关、抽到新单位都会回来使用）
- 数据累积（用户阵容数据可反向优化算法）

### 8.2 成功指标

**技术指标：**
- 计算准确度：推荐阵容 vs 实际通关率 ≥ 90%
- 响应速度：大规模计算 < 3秒

**用户指标：**
- DAU (Daily Active Users)
- 平均停留时间 > 5分钟
- 功能使用率：阵容优化 > 升级建议 > 波次分析

---

## 九、未来扩展方向

1. **自动战斗模拟器**
   - 实现完整的战斗逻辑模拟
   - 输出战斗回放动画

2. **PvP模式支持**
   - 如果游戏有PvP，分析对战阵容

3. **社区贡献数据**
   - 用户上传实际战斗结果，反馈推荐准确度
   - 构建众包数据集

4. **AI辅助决策**
   - 训练机器学习模型，学习最优阵容模式
   - 自适应玩家风格（激进/稳健）

5. **移动端适配**
   - 开发iOS/Android原生应用
   - 实时游戏数据同步（如果Roblox API允许）

---

## 十、总结

这个工具的核心竞争力在于：
1. **个性化**：基于玩家实际拥有的单位，而非理论最强
2. **可解释性**：不仅告诉"是什么"，还解释"为什么"
3. **动态性**：支持等级变化、技能组合的实时计算

通过完整的游戏数据采集、精确的数学建模和友好的用户界面，我们能为玩家解决"计算复杂度"这一核心痛点，帮助他们更高效地通关游戏，享受策略规划的乐趣。
